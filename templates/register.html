{% extends "base.html" %}
{% block title %}Register{% endblock %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header bg-primary text-white"><h4>üîê Register</h4></div>
            <div class="card-body">

                <form method="POST">
                    {{ form.hidden_tag() }}
                    <div class="mb-3">
                        <label>Name</label>
                        {{ form.name(class="form-control") }}
                    </div>
                    <div class="mb-3">
                        <label>Email</label>
                        {{ form.email(class="form-control") }}

                        {% for error in form.email.errors %}
                            <div class="text-danger small mt-1">
                                {{ error }}
                            </div>
                        {% endfor %}
                    </div>
                    <div class="mb-3">
                        {{ form.password.label(class="form-label") }}
    
                        <div class="input-group">
                            {{ form.password(class="form-control", id="passwordInput", onkeyup="checkStrength()") }}
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword()">
                            <i class="bi bi-eye" id="toggleIcon"></i>
                            </button>
                        </div>

                        <div class="progress mt-2" style="height: 5px;">
                            <div id="strengthBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <small id="strengthText" class="text-muted" style="font-size: 0.8rem;">Strength: Too Short</small>

                        <div class="mt-2 text-muted small">
                            <div id="check-len"><i class="bi bi-circle"></i> 8+ Characters</div>
                            <div id="check-upper"><i class="bi bi-circle"></i> Uppercase Letter</div>
                            <div id="check-lower"><i class="bi bi-circle"></i> Lowercase Letter</div>
                            <div id="check-num"><i class="bi bi-circle"></i> Number</div>
                            <div id="check-sym"><i class="bi bi-circle"></i> Symbol</div>
                        </div>

                        {% for error in form.password.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>

<script>
    function togglePassword() {
        const input = document.getElementById("passwordInput");
        const icon = document.getElementById("toggleIcon");
        if (input.type === "password") {
            input.type = "text";
            icon.classList.remove("bi-eye");
            icon.classList.add("bi-eye-slash");
        } else {
            input.type = "password";
            icon.classList.remove("bi-eye-slash");
            icon.classList.add("bi-eye");
        }
    }

    function checkStrength() {
        const password = document.getElementById("passwordInput").value;
        let score = 0;

        // 1. Check Requirements & Update Icons
        const rules = [
            { id: "check-len", valid: password.length >= 8 },
            { id: "check-upper", valid: /[A-Z]/.test(password) },
            { id: "check-lower", valid: /[a-z]/.test(password) },
            { id: "check-num", valid: /\d/.test(password) },
            { id: "check-sym", valid: /[!@#$%^&*(),.?":{}|<>]/.test(password) }
        ];

        rules.forEach(rule => {
            const el = document.getElementById(rule.id);
            const icon = el.querySelector("i");
            if (rule.valid) {
                el.classList.add("text-success");
                el.classList.remove("text-muted");
                icon.classList.remove("bi-circle");
                icon.classList.add("bi-check-circle-fill");
                score++;
            } else {
                el.classList.remove("text-success");
                el.classList.add("text-muted");
                icon.classList.remove("bi-check-circle-fill");
                icon.classList.add("bi-circle");
            }
        });

        // 2. Update Progress Bar
        const bar = document.getElementById("strengthBar");
        const text = document.getElementById("strengthText");
        
        let width = (score / 5) * 100;
        let color = "red";
        let label = "Weak";

        if (score <= 2) { color = "dc3545"; label = "Weak"; }       // Red
        else if (score <= 4) { color = "ffc107"; label = "Medium"; } // Yellow
        else { color = "198754"; label = "Strong"; }                 // Green

        bar.style.width = width + "%";
        bar.style.backgroundColor = "#" + color;
        text.innerText = "Strength: " + label;
    }
</script>
                    {{ form.submit(class="btn btn-primary w-100") }}
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}